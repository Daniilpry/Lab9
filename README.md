# Lab9

# –ó–∞–≤–¥–∞–Ω–Ω—è 1

## –û–ø–∏—Å

–¶—è –ø—Ä–æ–≥—Ä–∞–º–∞ –Ω–∞ C –≤–∏–∫–æ–Ω—É—î –∫–æ–º–∞–Ω–¥—É `getent passwd`, —â–æ–± –∑—á–∏—Ç–∞—Ç–∏ —Å–ø–∏—Å–æ–∫ —É—Å—ñ—Ö –æ–±–ª—ñ–∫–æ–≤–∏—Ö –∑–∞–ø–∏—Å—ñ–≤ —É —Å–∏—Å—Ç–µ–º—ñ. –î–∞–ª—ñ –≤–æ–Ω–∞ –ø–µ—Ä–µ–≤—ñ—Ä—è—î, —è–∫—ñ –∑ –Ω–∏—Ö —î –∑–≤–∏—á–∞–π–Ω–∏–º–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞–º–∏ (UID ‚â• 1000 –∞–±–æ ‚â• 500 ‚Äî –∑–∞–ª–µ–∂–Ω–æ –≤—ñ–¥ –¥–∏—Å—Ç—Ä–∏–±—É—Ç–∏–≤–∞), —Ç–∞ –≤–∏–∫–ª—é—á–∞—î –ø–æ—Ç–æ—á–Ω–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤.

## –†–µ–∞–ª—ñ–∑–∞—Ü—ñ—è 

``` C
#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <unistd.h>


void print_usernames();

int main(){
	print_usernames();
	return 0;
}

void print_usernames(){
	FILE *file = popen("getent passwd", "r");
	if (!file){
		printf("error running the command");
		return;
	}
	char line[256];
	uid_t my_userID = getuid();

	while(fgets(line, sizeof(line), file)){
		char *username = strtok(line, ":");
		strtok(NULL, ":"); //password
		char *uid = strtok(NULL, ":");
		if(atoi(uid) >= 1000 && atoi(uid) != my_userID){
			printf("%s \n", username);
		}
	}
	pclose(file);
}
```

# –ó–∞–≤–¥–∞–Ω–Ω—è 2

## –û–ø–∏—Å

–¶—è –ø—Ä–æ–≥—Ä–∞–º–∞ –¥–µ–º–æ–Ω—Å—Ç—Ä—É—î, —è–∫ –∑–≤–∏—á–∞–π–Ω–∏–π –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –º–æ–∂–µ –≤–∏–∫–æ–Ω–∞—Ç–∏ –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–∏–≤–Ω—É –∫–æ–º–∞–Ω–¥—É (`cat /etc/shadow`) –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é `sudo`, —è–∫—â–æ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —Å–∏—Å—Ç–µ–º–∏ —Ü–µ –¥–æ–∑–≤–æ–ª—è—î.
> ‚ö†–§–∞–π–ª `/etc/shadow` –∑–±–µ—Ä—ñ–≥–∞—î —Ö–µ—à—ñ –ø–∞—Ä–æ–ª—ñ–≤ —É—Å—ñ—Ö –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ —Å–∏—Å—Ç–µ–º–∏ —ñ –∑–∞–∑–≤–∏—á–∞–π –∑–∞—Ö–∏—â–µ–Ω–∏–π –≤—ñ–¥ —á–∏—Ç–∞–Ω–Ω—è. –¢–æ–º—É –∫–æ–º–∞–Ω–¥–∞ –ø–æ—Ç—Ä–µ–±—É—î –ø—Ä–∞–≤ —Å—É–ø–µ—Ä–∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞.

---

## –†–µ–∞–ª—ñ–∑–∞—Ü—ñ—è 

``` C
#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <unistd.h>


void shadow();

int main(){
        shadow();
        return 0;
}

void shadow(){
        FILE *file = popen("sudo cat /etc/shadow", "r");
        if (!file){
                printf("error running the command");
                return;
        }
        char line[256];
        while(fgets(line, sizeof(line), file)){
        	printf("%s", line);
        }
        pclose(file);
}
```

# –ó–∞–≤–¥–∞–Ω–Ω—è 3

## –û–ø–∏—Å

–¶—è –ø—Ä–æ–≥—Ä–∞–º–∞ –Ω–∞ –º–æ–≤—ñ C –≤–∏–∫–æ–Ω—É—î –¥–≤—ñ —Å–∏—Å—Ç–µ–º–Ω—ñ –∫–æ–º–∞–Ω–¥–∏:
- `whoami` ‚Äî –¥–ª—è –≤–∏–≤–µ–¥–µ–Ω–Ω—è —ñ–º–µ–Ω—ñ –ø–æ—Ç–æ—á–Ω–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
- `id` ‚Äî –¥–ª—è –≤–∏–≤–µ–¥–µ–Ω–Ω—è UID, GID —Ç–∞ —Å–ø–∏—Å–∫—É –≥—Ä—É–ø, –¥–æ —è–∫–∏—Ö –Ω–∞–ª–µ–∂–∏—Ç—å –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á

–ü—Ä–æ–≥—Ä–∞–º–∞ –¥–µ–º–æ–Ω—Å—Ç—Ä—É—î:
- —Ö—Ç–æ –∑–∞—Ä–∞–∑ –≤–∏–∫–æ–Ω—É—î –ø—Ä–æ–≥—Ä–∞–º—É
- –¥–æ —è–∫–∏—Ö –≥—Ä—É–ø –Ω–∞–ª–µ–∂–∏—Ç—å —Ü–µ–π –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á (–≤–∫–ª—é—á–∞—é—á–∏ –≤—Ç–æ—Ä–∏–Ω–Ω—ñ –≥—Ä—É–ø–∏)

``` C
#include <stdio.h>
#include <stdlib.h>
#include <unistd.h>
#include <sys/wait.h>

int main() {
	FILE *file1 = popen("whoami", "r");
	if (!file1){
		printf("error running command\n");
		return 1;
	}
	char line1[256];
	fgets(line1, sizeof(line1), file1);
	printf("result of whoami command -> %s", line1);
	pclose(file1);

	FILE *file2 = popen("id", "r");
	if (!file2){
		printf("error running command\n");
                return 1;
        }
        char line2[256];
        fgets(line2, sizeof(line2), file2);
        printf("result of id command -> %s", line2);
        pclose(file2);
}
```

# –ó–∞–≤–¥–∞–Ω–Ω—è –∑–∞ –≤–∞—Ä—ñ–∞–Ω—Ç–æ–º `17`
## üîé –û–ø–∏—Å

–£ Unix-–ø–æ–¥—ñ–±–Ω–∏—Ö —Å–∏—Å—Ç–µ–º–∞—Ö `sudo` –¥–æ–∑–≤–æ–ª—è—î –∑–≤–∏—á–∞–π–Ω–∏–º –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞–º –≤–∏–∫–æ–Ω—É–≤–∞—Ç–∏ –∫–æ–º–∞–Ω–¥–∏ –≤—ñ–¥ —ñ–º–µ–Ω—ñ –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–∞ (root). –ó–∞–∑–≤–∏—á–∞–π —Ü–µ –≤–∏–º–∞–≥–∞—î –≤–≤–µ–¥–µ–Ω–Ω—è –ø–∞—Ä–æ–ª—è. –ü—Ä–æ—Ç–µ —ñ–Ω–æ–¥—ñ –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–∏ —Å–ø—Ä–æ—â—É—é—Ç—å –¥–æ—Å—Ç—É–ø, –¥–æ–¥–∞—é—á–∏ `NOPASSWD`, —â–æ –¥–æ–∑–≤–æ–ª—è—î –≤–∏–∫–æ–Ω—É–≤–∞—Ç–∏ `sudo` –±–µ–∑ –∂–æ–¥–Ω–æ—ó –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ –æ—Å–æ–±–∏.

> –ü—Ä–∏–∫–ª–∞–¥ –Ω–µ–±–µ–∑–ø–µ—á–Ω–æ–≥–æ –∑–∞–ø–∏—Å—É —É —Ñ–∞–π–ª—ñ `/etc/sudoers`:
> ```
> user ALL=(ALL) NOPASSWD:ALL
> ```

---

## ‚ö†–ó–∞–≥—Ä–æ–∑–∏ —Ç–∞ —Ä–∏–∑–∏–∫–∏

### 1. –ö–æ–º–ø—Ä–æ–º–µ—Ç–∞—Ü—ñ—è –æ–¥–Ω–æ–≥–æ –æ–±–ª—ñ–∫–æ–≤–æ–≥–æ –∑–∞–ø–∏—Å—É = root-–¥–æ—Å—Ç—É–ø

–ë—É–¥—å-—è–∫–∏–π –∑–ª–æ–º –∞–±–æ –ø–µ—Ä–µ—Ö–æ–ø–ª–µ–Ω–Ω—è –∞–∫–∞—É–Ω—Ç—É –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ (—á–µ—Ä–µ–∑ —Ñ—ñ—à–∏–Ω–≥, –≤—Ä–∞–∑–ª–∏–≤—ñ—Å—Ç—å –∞–±–æ –±—Ä—É—Ç—Ñ–æ—Ä—Å) –¥–æ–∑–≤–æ–ª—è—î –∑–ª–æ–≤–º–∏—Å–Ω–∏–∫—É –º–∏—Ç—Ç—î–≤–æ –æ—Ç—Ä–∏–º–∞—Ç–∏ –ø–æ–≤–Ω–∏–π –∫–æ–Ω—Ç—Ä–æ–ª—å –Ω–∞–¥ —Å–∏—Å—Ç–µ–º–æ—é.

---

### 2. –ú–æ–∂–ª–∏–≤—ñ—Å—Ç—å –ø–æ—Å—Ç—ñ–π–Ω–æ–≥–æ –±–µ–∫–¥–æ—Ä—É

–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á –±–µ–∑ –ø–∞—Ä–æ–ª—è –º–æ–∂–µ:
- –í—Å—Ç–∞–Ω–æ–≤–∏—Ç–∏ rootkit –∞–±–æ —Ç—Ä–æ—è–Ω
- –î–æ–¥–∞—Ç–∏ —Å–µ–±–µ –¥–æ `cron` –¥–ª—è –∑–∞–ø—É—Å–∫—É –±–µ–∫–¥–æ—Ä—ñ–≤
- –í—ñ–¥–∫–ª—é—á–∏—Ç–∏ –∞–Ω—Ç–∏–≤—ñ—Ä—É—Å–Ω—ñ –∞–±–æ –º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥–æ–≤—ñ —Å–∏—Å—Ç–µ–º–∏

---

### 3. –®–ø–∏–≥—É–≤–∞–Ω–Ω—è —Ç–∞ –≤–∏—Ç—ñ–∫ –¥–∞–Ω–∏—Ö

Root-–¥–æ—Å—Ç—É–ø –¥–æ–∑–≤–æ–ª—è—î:
- –ß–∏—Ç–∞—Ç–∏ –≤–º—ñ—Å—Ç –±—É–¥—å-—è–∫–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—Ü—å–∫–æ–≥–æ –∫–∞—Ç–∞–ª–æ–≥—É
- –ü—Ä–æ—Å–ª—É—Ö–æ–≤—É–≤–∞—Ç–∏ –º–µ—Ä–µ–∂–µ–≤—ñ —ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∏ (`tcpdump`)
- –ó–±–∏—Ä–∞—Ç–∏ SSH-–∫–ª—é—á—ñ, —Ñ–∞–π–ª–∏ cookie, –ø–∞—Ä–æ–ª—ñ

---

### 4. –í—ñ–¥—Å—É—Ç–Ω—ñ—Å—Ç—å –∫–æ–Ω—Ç—Ä–æ–ª—é –∑–∞ –¥—ñ—è–º–∏

- –í—Å—ñ `sudo`-–æ–ø–µ—Ä–∞—Ü—ñ—ó –≤—ñ–¥–±—É–≤–∞—é—Ç—å—Å—è –±–µ–∑ –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è, —Ç–æ–º—É –Ω–µ –º–æ–∂–Ω–∞ –≤—ñ–¥—Å–ª—ñ–¥–∫—É–≤–∞—Ç–∏, —á–∏ –≤–æ–Ω–∏ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω—ñ.
- –ë—É–¥—å-—è–∫—ñ –∫—Ä–∏—Ç–∏—á–Ω—ñ –¥—ñ—ó (–≤–∏–¥–∞–ª–µ–Ω–Ω—è —Ñ–∞–π–ª—ñ–≤, –ø–µ—Ä–µ–∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è, –≤–∏–º–∫–Ω–µ–Ω–Ω—è —Å–µ—Ä–≤—ñ—Å—ñ–≤) –º–æ–∂—É—Ç—å –±—É—Ç–∏ –≤–∏–∫–æ–Ω–∞–Ω—ñ –Ω–µ–ø–æ–º—ñ—Ç–Ω–æ.

---

### 5. –ù–µ–¥–æ—Ç—Ä–∏–º–∞–Ω–Ω—è –ø–æ–ª—ñ—Ç–∏–∫ –±–µ–∑–ø–µ–∫–∏

- –ù–µ –≤—ñ–¥–ø–æ–≤—ñ–¥–∞—î —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∞–º: ISO 27001, CIS Benchmarks, NIST 800-53
- –ü–æ—Ä—É—à—É—î –±–∞–∑–æ–≤—ñ –ø—Ä–∏–Ω—Ü–∏–ø–∏ –∫–æ–Ω—Ç—Ä–æ–ª—å–æ–≤–∞–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø—É —Ç–∞ –º—ñ–Ω—ñ–º—ñ–∑–∞—Ü—ñ—ó –ø–æ–≤–Ω–æ–≤–∞–∂–µ–Ω—å
